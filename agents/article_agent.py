"""
æ–‡ç« æ’°å†™Agent
è´Ÿè´£ç”Ÿæˆå•ç¯‡å®Œæ•´çš„å­¦ä¹ æ–‡ç« 
"""
from .base_agent import BaseAgent
from config import AGENT_ROLES, ARTICLE_CONFIG


class ArticleAgent(BaseAgent):
    """æ–‡ç« æ’°å†™ä¸“å®¶Agent"""
    
    def __init__(self):
        role = AGENT_ROLES["article_writer"]
        super().__init__(role["name"], role["system_prompt"])
    
    def generate_article(self, topic: str, description: str = "", extra_context: str = "") -> dict:
        """
        ç”Ÿæˆå®Œæ•´çš„å­¦ä¹ æ–‡ç« 
        
        Args:
            topic: æ–‡ç« ä¸»é¢˜
            description: è¡¥å……æè¿°
            extra_context: é¢å¤–çš„å‚è€ƒèµ„æ–™
            
        Returns:
            åŒ…å«æ ‡é¢˜å’Œå†…å®¹çš„å­—å…¸
        """
        context_section = ""
        if extra_context:
            context_section = f"""
## å‚è€ƒèµ„æ–™
ä»¥ä¸‹æ˜¯æœç´¢å’Œæ•´ç†çš„å‚è€ƒèµ„æ–™ï¼Œè¯·åœ¨æ’°å†™æ–‡ç« æ—¶å……åˆ†å‚è€ƒå¹¶èå…¥å†…å®¹ï¼š

{extra_context}

---
"""

        prompt = f"""è¯·æ’°å†™ä¸€ç¯‡å…³äºã€Œ{topic}ã€çš„æ·±åº¦å­¦ä¹ æ–‡ç« ã€‚

{f'ç”¨æˆ·è¦æ±‚ï¼š{description}' if description else ''}
{context_section}

## é‡è¦è¦æ±‚
1. æ–‡ç« å­—æ•°å¿…é¡»åœ¨ 3000-5000 å­—ä¹‹é—´ï¼Œå†…å®¹è¦éå¸¸ä¸°å¯Œè¯¦å®
2. æ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½è¦æ·±å…¥è®²è§£ï¼Œä¸èƒ½åªæ˜¯ç®€å•ç½—åˆ—
3. å¿…é¡»åŒ…å«å¤§é‡å®é™…ä»£ç ç¤ºä¾‹ï¼Œä»£ç è¦å®Œæ•´å¯è¿è¡Œ
4. å¿…é¡»åŒ…å«å®é™…åº”ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µ
5. è¯­è¨€é€šä¿—æ˜“æ‡‚ï¼Œå¾ªåºæ¸è¿›

## æ–‡ç« ç»“æ„ï¼ˆä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹Markdownæ ¼å¼ï¼‰

# [æ–‡ç« æ ‡é¢˜]

> ğŸ“š **å¯¼è¯»**ï¼š[2-3å¥è¯æ¦‚æ‹¬æ–‡ç« å†…å®¹ã€å­¦ä¹ ä»·å€¼å’Œç›®æ ‡è¯»è€…]

## ğŸ“– ç›®å½•
- [1. å¼•è¨€](#1-å¼•è¨€)
- [2. åŸºç¡€æ¦‚å¿µ](#2-åŸºç¡€æ¦‚å¿µ)
- [3. æ ¸å¿ƒå†…å®¹](#3-æ ¸å¿ƒå†…å®¹)
- [4. å®è·µåº”ç”¨](#4-å®è·µåº”ç”¨)
- [5. è¿›é˜¶æ‹“å±•](#5-è¿›é˜¶æ‹“å±•)
- [6. æ€»ç»“](#6-æ€»ç»“)

---

## 1. å¼•è¨€

[è¯¦ç»†ä»‹ç»ä¸»é¢˜èƒŒæ™¯ã€å‘å±•å†å²ã€å­¦ä¹ ä»·å€¼ï¼Œè‡³å°‘300å­—]

### 1.1 ä¸ºä»€ä¹ˆè¦å­¦ä¹ {topic}

[è§£é‡Šå­¦ä¹ çš„å¿…è¦æ€§å’Œä»·å€¼]

### 1.2 å­¦ä¹ è·¯çº¿å›¾

[ç»™å‡ºæ¸…æ™°çš„å­¦ä¹ è·¯å¾„å»ºè®®]

---

## 2. åŸºç¡€æ¦‚å¿µ

### 2.1 [æ ¸å¿ƒæ¦‚å¿µ1]

[è¯¦ç»†è§£é‡Šï¼Œè‡³å°‘200å­—]

> ğŸ’¡ **å…³é”®ç‚¹**ï¼š[é‡è¦æç¤º]

**ç¤ºä¾‹ä»£ç ï¼š**
```language
// å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼Œå¸¦è¯¦ç»†æ³¨é‡Š
```

### 2.2 [æ ¸å¿ƒæ¦‚å¿µ2]

[è¯¦ç»†è§£é‡Š]

| æ¦‚å¿µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| xxx | xxx | xxx |

### 2.3 [æ ¸å¿ƒæ¦‚å¿µ3]

[è¯¦ç»†è§£é‡Š]

---

## 3. æ ¸å¿ƒå†…å®¹

### 3.1 [é‡è¦çŸ¥è¯†ç‚¹1]

[æ·±å…¥è®²è§£ï¼Œè‡³å°‘400å­—]

**å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š**
```language
// å®Œæ•´çš„ã€å¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹
// åŒ…å«è¯¦ç»†æ³¨é‡Š
```

**ä»£ç è§£æï¼š**
- ç¬¬1è¡Œï¼š[è§£é‡Š]
- ç¬¬2è¡Œï¼š[è§£é‡Š]

### 3.2 [é‡è¦çŸ¥è¯†ç‚¹2]

[æ·±å…¥è®²è§£]

### 3.3 [é‡è¦çŸ¥è¯†ç‚¹3]

[æ·±å…¥è®²è§£]

---

## 4. å®è·µåº”ç”¨

### 4.1 å®æˆ˜æ¡ˆä¾‹

[å®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹ï¼ŒåŒ…å«éœ€æ±‚åˆ†æã€è®¾è®¡æ€è·¯ã€å®Œæ•´ä»£ç ]

**éœ€æ±‚åˆ†æï¼š**
[åˆ†æ]

**è®¾è®¡æ€è·¯ï¼š**
[æ€è·¯]

**å®Œæ•´å®ç°ï¼š**
```language
// å®Œæ•´çš„é¡¹ç›®ä»£ç 
```

### 4.2 æœ€ä½³å®è·µ

- âœ… **æ¨èåšæ³•1**ï¼š[è¯¦ç»†è¯´æ˜]
- âœ… **æ¨èåšæ³•2**ï¼š[è¯¦ç»†è¯´æ˜]
- âŒ **é¿å…åšæ³•1**ï¼š[è¯¦ç»†è¯´æ˜]
- âŒ **é¿å…åšæ³•2**ï¼š[è¯¦ç»†è¯´æ˜]

### 4.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

**Q1: [å¸¸è§é—®é¢˜1]ï¼Ÿ**

A: [è¯¦ç»†è§£ç­”]

**Q2: [å¸¸è§é—®é¢˜2]ï¼Ÿ**

A: [è¯¦ç»†è§£ç­”]

---

## 5. è¿›é˜¶æ‹“å±•

### 5.1 é«˜çº§ç‰¹æ€§

[ä»‹ç»é«˜çº§ç”¨æ³•]

### 5.2 æ€§èƒ½ä¼˜åŒ–

[æ€§èƒ½ä¼˜åŒ–å»ºè®®]

### 5.3 ç›¸å…³æŠ€æœ¯

[ç›¸å…³æŠ€æœ¯æ ˆä»‹ç»]

---

## 6. æ€»ç»“

### ğŸ“ æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **[è¦ç‚¹1]**ï¼š[ç®€è¦è¯´æ˜]
2. **[è¦ç‚¹2]**ï¼š[ç®€è¦è¯´æ˜]
3. **[è¦ç‚¹3]**ï¼š[ç®€è¦è¯´æ˜]
4. **[è¦ç‚¹4]**ï¼š[ç®€è¦è¯´æ˜]
5. **[è¦ç‚¹5]**ï¼š[ç®€è¦è¯´æ˜]

### ğŸ¯ å­¦ä¹ å»ºè®®

[ç»™å‡ºå…·ä½“çš„åç»­å­¦ä¹ å»ºè®®å’Œèµ„æºæ¨è]

### ğŸ“š æ¨èèµ„æº

- [èµ„æº1]
- [èµ„æº2]
- [èµ„æº3]

---

> ğŸ’¬ **ç»“è¯­**ï¼š[é¼“åŠ±æ€§çš„ç»“æŸè¯­]

è¯·ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡ºï¼Œç¡®ä¿å†…å®¹ä¸°å¯Œã€ä»£ç å®Œæ•´ã€æ’ç‰ˆç¾è§‚ã€‚"""

        content = self.chat(prompt, temperature=0.7)
        
        # æå–æ ‡é¢˜
        lines = content.strip().split('\n')
        title = topic
        if lines and lines[0].startswith('#'):
            title = lines[0].lstrip('#').strip()
        
        return {
            "title": title,
            "content": content,
            "topic": topic,
            "word_count": len(content)
        }
